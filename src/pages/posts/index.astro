---
import { getCollection } from "astro:content";
import { ArrowLeft } from "lucide-preact";

import Footer from "~/components/Footer.astro";
import Head from "~/components/Head.astro";
import List from "~/components/Widgets/List.astro";
import Document from "~/layouts/Document.astro";
import {
  filterPosts,
  mapPostToListItem,
  sortPostsByFeatured,
} from "~/utils/content";

const [posts, archivedPosts] = await Promise.all([
  getCollection("posts").then((posts) =>
    posts
      .filter(filterPosts({ archived: false }))
      .sort(sortPostsByFeatured)
      .map(mapPostToListItem),
  ),

  getCollection("posts").then((posts) =>
    posts
      .filter((post) => post.data.archived)
      .sort(sortPostsByFeatured)
      .map(mapPostToListItem),
  ),
]);
---

<Head
  title="Blog Posts"
  description="Articles on TypeScript, Angular, React, RxJS, Node.js, and web development. Practical tutorials, code examples, and software engineering insights by Ezz Abuzaid."
  type="blog"
/>

<Document>
  <main
    class="flex flex-col h-full mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-16 space-y-12 pb-8"
  >
    <!-- Brutalist Hero for Posts Page -->
    <section class="space-y-4 pt-8">
      <h1
        class="font-[Fraunces] text-5xl sm:text-6xl font-bold tracking-tight text-gray-50 leading-[0.9]"
      >
        <span class="text-primary-500">◇</span> Writings
      </h1>
      <p class="text-gray-500 text-base">
        All my posts on software engineering, web development, and building
        products.
      </p>
    </section>

    <div class="space-y-12 z-10">
      <List id="posts" items={posts} variant="borderless" />
      {
        archivedPosts.length > 0 ? (
          <section class="space-y-6">
            <h2 class="flex items-center font-mono text-xs uppercase tracking-[0.15em] text-gray-500">
              <span class="text-gray-600 mr-2">◇</span>
              Archived
            </h2>
            <List id="archived" items={archivedPosts} variant="borderless" />
          </section>
        ) : null
      }
    </div>
  </main>

  <Footer class="max-w-3xl border-t border-gray-800">
    <div
      class="flex items-center justify-center mt-4 md:block md:order-1 md:mt-0"
    >
      <a
class="default-focus mt-4 default-transition group inline-flex items-center justify-center space-x-2 px-3 py-1 font-mono text-xs uppercase tracking-wider text-gray-400 hover:text-primary-500 bg-gray-900 hover:bg-gray-800 border border-gray-800 hover:border-primary-500/50"
        href="/"
      >
        <ArrowLeft
          class="w-4 h-4 default-transition transform group-hover:-translate-x-1"
        />
        <span>Go back</span>
      </a>
    </div>
  </Footer>
</Document>
