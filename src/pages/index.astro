---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

import Footer from '~/components/Footer.astro';
import Head from '~/components/Head.astro';
import List from '~/components/Widgets/List.astro';
import Timeline from '~/components/Widgets/Timeline.astro';
import Document from '~/layouts/Document.astro';
import { filterPosts, mapPostToListItem, sortPostsByFeatured } from '~/utils/content';

const [posts, projects, socialLinks] = await Promise.all([
	getCollection('posts').then((posts) =>
		posts
			.filter(filterPosts({ archived: false }))
			.sort(sortPostsByFeatured)
			.map(mapPostToListItem),
	),
	getCollection('projects').then((projects) =>
		projects
			.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
			.map(({ data }) => data),
	),
	getCollection('socialLinks').then((arr) =>
		arr.sort((a, b) => a.data.name.localeCompare(b.data.name)),
	),
]);
---

<Head />

<Document>
	<main class="flex flex-col h-full mx-auto max-w-2xl px-4 sm:px-6 lg:px-8 py-16 space-y-12 pb-8">
		<!-- Minimal Hero -->
		<section class="space-y-4">
			<h1 class="text-3xl font-bold text-gray-900 dark:text-white">
				Hi, I'm Ezz
			</h1>
			<p class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed">
				I write about software engineering, web development, and building products.
			</p>
			<div class="flex items-center space-x-4 pt-2">
				{socialLinks.map(({ data: socialLink }) => (
					<a
						href={socialLink.url}
						target="_blank"
						rel="noreferrer"
						class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white default-transition"
						title={socialLink.name}
					>
						<Icon class="size-5" name={socialLink.icon} />
						<span class="sr-only">{socialLink.name}</span>
					</a>
				))}
			</div>
		</section>

		<!-- Projects Section -->
		<Timeline
			id="projects"
			projects={projects}
			title="Projects"
			variant="borderless"
		/>

		<!-- Posts Section -->
		<List
			id="posts"
			items={posts}
			title="Writing"
			variant="borderless"
		/>
	</main>

	<Footer class="max-w-2xl">
		<div class="mt-8 md:order-1 md:mt-0">
			<p class="text-center text-xs leading-5 text-gray-600 dark:text-zinc-200 font-medium">&copy; {new Date().getFullYear()}</p>
		</div>
	</Footer>
</Document>
