@reference "./global.css";

/* ============================================================================
   BRUTALIST EDITORIAL PROSE
   Terminal-inspired typography with editorial flair
   ============================================================================ */

/* Base prose - editorial with good readability */
.prose {
  font-size: 1.125rem;
  line-height: 1.8;
  color: var(--color-gray-300);
  font-family: var(--font-sans);
}

/* Paragraph spacing and wrapping */
.prose p {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  hyphens: auto;
  overflow-wrap: anywhere;
  text-wrap: pretty;
}

/* Headings - Fraunces for editorial punch */
.prose h2 {
  font-family: var(--font-display);
  font-size: 1.75rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-top: 3em;
  margin-bottom: 1em;
  color: var(--color-fg);
  position: relative;
  padding-left: 1rem;
  border-left: 3px solid var(--color-coral);
}

.prose h3 {
  font-family: var(--font-display);
  font-size: 1.375rem;
  font-weight: 600;
  letter-spacing: -0.01em;
  margin-top: 2.5em;
  margin-bottom: 0.75em;
  color: var(--color-fg);
}

.prose h4 {
  font-family: var(--font-display);
  font-size: 1.125rem;
  font-weight: 600;
  margin-top: 2em;
  margin-bottom: 0.5em;
  color: var(--color-fg);
}

/* Links - coral accent */
.prose a {
  color: var(--color-coral);
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-thickness: 1px;
  text-decoration-color: var(--color-coral);
  opacity: 0.9;
  transition: opacity 0.2s ease-out, text-decoration-thickness 0.2s ease-out;
}

.prose a:hover {
  opacity: 1;
  text-decoration-thickness: 2px;
}

.prose a:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--color-bg), 0 0 0 4px var(--color-coral);
}

/* Heading anchor links */
.prose h1 > a,
.prose h2 > a,
.prose h3 > a,
.prose h4 > a,
.prose h5 > a,
.prose h6 > a {
  float: left;
  margin-left: -1.25rem;
  border: none;
  opacity: 0;
  text-decoration: none;
  transition: opacity 0.2s ease-out;
  color: var(--color-coral);
}

.prose h1:hover > a,
.prose h2:hover > a,
.prose h3:hover > a,
.prose h4:hover > a,
.prose h5:hover > a,
.prose h6:hover > a {
  opacity: 1;
}

.prose h1 > a .icon-link:before,
.prose h2 > a .icon-link:before,
.prose h3 > a .icon-link:before,
.prose h4 > a .icon-link:before,
.prose h5 > a .icon-link:before,
.prose h6 > a .icon-link:before {
  content: "◇";
}

/* Lists - diamond bullets */
.prose ul,
.prose ol {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  padding-left: 1.5em;
}

.prose li {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose ul > li::marker {
  content: "◇ ";
  color: var(--color-coral);
}

.prose ol > li::marker {
  color: var(--color-coral);
  font-family: var(--font-mono);
}

/* Strong text */
.prose strong {
  font-weight: 600;
  color: var(--color-fg);
}

/* Inline code - terminal style */
.prose :where(code):not(:where(pre *)) {
  font-family: var(--font-mono);
  font-size: 0.875em;
  font-weight: 500;
  padding: 0.2em 0.4em;
  background-color: var(--color-gray-darker);
  color: var(--color-cyan);
  border: 1px solid var(--color-border);
}

/* Blockquotes - brutalist left border */
.prose blockquote:not(.callout) {
  font-style: normal;
  border-left-width: 3px;
  border-left-color: var(--color-gray-dark);
  padding-left: 1.25em;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  color: var(--color-gray);
}

.prose blockquote p:first-of-type::before,
.prose blockquote p:last-of-type::after {
  content: none;
}

/* Horizontal rules - subtle divider */
.prose hr {
  margin-top: 3em;
  margin-bottom: 3em;
  border: none;
  border-top: 1px solid var(--color-border);
}

/* Images - no rounded corners, sharp brutalist edges */
.prose img {
  margin-top: 2em;
  margin-bottom: 2em;
  border: 1px solid var(--color-border);
}

/* Tables - terminal-inspired */
.prose table {
  font-size: 0.875em;
  margin-top: 2em;
  margin-bottom: 2em;
  width: 100%;
  font-family: var(--font-mono);
}

.prose th {
  font-weight: 600;
  text-align: left;
  padding: 0.75em 1em;
  border-bottom: 2px solid var(--color-border-strong);
  color: var(--color-fg);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-size: 0.75em;
}

.prose td {
  padding: 0.75em 1em;
  border-bottom: 1px solid var(--color-border);
  color: var(--color-gray-300);
}

/* ============================================================================
   CODE BLOCKS - Terminal aesthetic
   ============================================================================ */

code[data-theme*=" "],
code[data-theme*=" "] span {
  @apply !bg-transparent;
  color: var(--shiki-dark);
}

.prose pre,
[data-rehype-pretty-code-figure] pre {
  font-size: 0.875rem;
  line-height: 1.7;
  padding: 1.25rem 1.5rem;
  overflow-x: auto;
  background-color: var(--color-gray-darker) !important;
  border: 1px solid var(--color-border);
  font-family: var(--font-mono);
}

figcaption + pre {
  border-top: none !important;
}

[data-rehype-pretty-code-title] {
  display: inline-flex;
  align-items: center;
  width: 100%;
  padding: 0.75rem 1rem;
  font-weight: 500;
  font-size: 0.75rem;
  border: 1px solid var(--color-border);
  border-bottom: none;
  background-color: var(--color-gray-800);
  color: var(--color-gray);
  font-family: var(--font-mono);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* Language icons */
figcaption[data-language="js"]::before,
figcaption[data-language="javascript"]::before {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
  content: url("/lang/javascript.svg");
}

figcaption[data-language="ts"]::before,
figcaption[data-language="typescript"]::before {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
  content: url("/lang/typescript.svg");
}

figcaption[data-language="jsx"]::before,
figcaption[data-language="tsx"]::before {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
  content: url("/lang/react.svg");
}

figcaption[data-language="rs"]::before,
figcaption[data-language="rust"]::before {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
  content: url("/lang/rust.svg");
  filter: invert(1);
}

figcaption[data-language="astro"]::before {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
  content: url("/lang/astro-dark.svg");
}

/* ============================================================================
   CALLOUTS - Brutalist style
   ============================================================================ */

.prose blockquote.callout,
.prose .callout {
  font-style: normal;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  padding: 1rem;
  background-color: var(--color-gray-darker);
  color: var(--color-gray-300);
  border-left: 3px solid var(--color-gray-dark);
}

.prose blockquote.callout > h5,
.prose .callout > h5 {
  margin: 0;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  line-height: 1.25;
  color: var(--color-fg);
  font-family: var(--font-mono);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.prose blockquote.callout > div :where(p, ul, ol):first-child,
.prose .callout > div :where(p, ul, ol):first-child {
  margin-top: 0;
}

.prose blockquote.callout > div :where(p, ul, ol):last-child,
.prose .callout > div :where(p, ul, ol):last-child {
  margin-bottom: 0;
}

.prose blockquote.callout :where(p):first-child::before,
.prose .callout :where(p):first-child::before,
.prose blockquote.callout :where(p):last-child::after,
.prose .callout :where(p):last-child::after {
  content: none;
}

/* Callout variants - coral accent for most important */
.prose blockquote.callout.note,
.prose .callout.note {
  border-left-color: var(--color-cyan);
}
.prose blockquote.callout.note > h5,
.prose .callout.note > h5 {
  color: var(--color-cyan);
}

.prose blockquote.callout.tip,
.prose .callout.tip {
  border-left-color: #28ca42;
}
.prose blockquote.callout.tip > h5,
.prose .callout.tip > h5 {
  color: #28ca42;
}

.prose blockquote.callout.important,
.prose .callout.important {
  border-left-color: var(--color-coral);
}
.prose blockquote.callout.important > h5,
.prose .callout.important > h5 {
  color: var(--color-coral);
}

.prose blockquote.callout.warning,
.prose .callout.warning {
  border-left-color: #ffbd2e;
}
.prose blockquote.callout.warning > h5,
.prose .callout.warning > h5 {
  color: #ffbd2e;
}

.prose blockquote.callout.caution,
.prose .callout.caution {
  border-left-color: #ff5f57;
}
.prose blockquote.callout.caution > h5,
.prose .callout.caution > h5 {
  color: #ff5f57;
}

/* ============================================================================
   BACKTRANSLATION ANIMATIONS
   Word swap crossfade and stacked cards
   ============================================================================ */

@keyframes crossfade-out {
  0%, 40% { opacity: 1; }
  50%, 100% { opacity: 0; }
}

@keyframes crossfade-in {
  0%, 40% { opacity: 0; }
  50%, 100% { opacity: 1; }
}

.prose .word-swap {
  position: relative;
  display: inline-block;
  color: var(--color-coral);
  font-weight: 600;
}

.prose .word-swap .from {
  animation: crossfade-out 3s ease-in-out infinite;
}

.prose .word-swap .to {
  position: absolute;
  left: 0;
  animation: crossfade-in 3s ease-in-out infinite;
}

/* Backtranslation Card */
.prose .bt-card {
  background: var(--color-gray-darker);
  border: 1px solid var(--color-border);
  padding: 1rem 1.25rem;
  font-family: var(--font-mono);
  font-size: 0.875rem;
  color: var(--color-gray-300);
  margin: 0;
}

.prose .bt-card .hl {
  color: var(--color-coral);
  font-weight: 600;
}

.prose .bt-arrow {
  text-align: center;
  color: var(--color-gray);
  font-size: 1.25rem;
  padding: 0.5rem 0;
  margin: 0;
}

/* Reduced motion - show both words statically */
@media (prefers-reduced-motion: reduce) {
  .prose .word-swap .from,
  .prose .word-swap .to {
    animation: none;
  }
  .prose .word-swap .to {
    position: static;
    opacity: 1;
  }
  .prose .word-swap .from::after {
    content: " → ";
    color: var(--color-gray);
  }
}
