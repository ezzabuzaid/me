---
import { format } from "date-fns";
import { Newspaper } from "lucide-preact";

import { cn } from "~/utils/cn";
import { loadIcon } from "~/utils/icon";

import type { CollectionEntry } from "astro:content";

type Item = CollectionEntry<"posts">["data"] & {
  href: string;
};

export interface Props {
  class?: string;
  empty?: {
    title?: string;
    description?: string;
  };
  href?: string;
  id: string;
  items: Array<Item>;
  title?: string;
  variant?: "default" | "borderless";
}

const {
  class: className,
  empty,
  href,
  id,
  items,
  title,
  variant = "default",
} = Astro.props as Props;

const hasUrl = !!href;
const TitleComponent = hasUrl ? "a" : "h3";
const anchorProps = hasUrl ? { href } : {};
---

<section
  class={cn(
    "bg-gray-950 overflow-auto",
    variant === "default" && title && "border border-gray-800 px-2 pb-2",
    variant === "borderless" && "bg-transparent",
    className,
  )}
  id={id}
>
  {
    title && (
      <TitleComponent
        class={cn(
          "flex items-center font-mono text-xs uppercase tracking-[0.15em] text-gray-400 mb-6",
          hasUrl
            ? "hover:text-primary-500 default-transition default-focus"
            : "",
        )}
        {...anchorProps}
      >
        <span class="text-primary-500 mr-2">â—‡</span>
        {title}
      </TitleComponent>
    )
  }

  {
    items.length > 0 ? (
      <ul class="flex flex-col space-y-0" role="list">
        {items.map(async (item) => {
          const Icon = await loadIcon(item.icon);

          const hasUrl = !!item.href;
          const Component = hasUrl ? "a" : "div";

          return (
            <li class="group">
              <Component
                href={item.href}
                class={cn(
                  "relative block py-4 border-b border-gray-800/50 default-transition",
                  "hover:bg-gray-900/50 px-2",
                )}
              >
                <div class="flex items-start justify-between gap-4">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-3">
                      <Icon class="w-4 h-4 text-gray-500 group-hover:text-primary-500 default-transition flex-shrink-0" />
                      <p class="font-[Fraunces] text-lg text-gray-100 group-hover:text-gray-50 default-transition truncate">
                        {item.title}
                      </p>
                    </div>
                    {item.description && variant === "borderless" && (
                      <p class="text-sm text-gray-500  line-clamp-2 pl-7">
                        {item.description}
                      </p>
                    )}
                  </div>

                  <time
                    class="font-mono text-xs text-gray-600 group-hover:text-gray-500 default-transition whitespace-nowrap flex-shrink-0"
                    datetime={item.publishedAt.toISOString()}
                    title={format(item.publishedAt, "PPP")}
                  >
                    {format(item.publishedAt, "dd-MM-yyyy")}
                  </time>
                </div>
              </Component>
            </li>
          );
        })}
      </ul>
    ) : (
      <div class="h-full flex items-center justify-center py-12">
        <div class="space-y-4 text-center">
          <Newspaper class="mx-auto text-gray-600" />

          <h3 class="font-mono text-sm uppercase tracking-[0.1em] text-gray-400">
            {empty?.title ?? "No posts here yet"}
          </h3>

          <p class="text-gray-600 text-sm">
            {empty?.description ?? "Stay tuned for more content soon"}
          </p>
        </div>
      </div>
    )
  }
</section>
